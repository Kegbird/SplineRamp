<!DOCTYPE html>
<html lang="it">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <title>Spline Ramp - Teoria</title>

</head>

<body style="background-color:black;">
  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="col">
        <a href="../index.html">
          <img class="img-fluid mx-auto d-block" src="images/banner.png">
        </a>
      </div>
    </div>
    <div class="row pt-4">
      <div class="col text-center">
        <a href="game.html">
          <button type="button" class="btn btn-light btn-lg">Gioca!</button>
        </a>
        <a href="manual.html">
          <button type="button" class="btn btn-light btn-lg">Manuale</button>
        </a>
      </div>
    </div>
    <div class="row pt-4 pb-4">
      <div class="panel col">
        <h1 class="text-center">Teoria</h1>
        <h3>Introduzione</h3>
        <p>
          Le rampe curve che il giocatore può definire nel gioco sono le seguenti:

        <ul>
          <li><a href="#bezier">Curve di Beziér</a></li>
          <li><a href="#hermite">Spline cubiche di Hermite</a></li>
          <li><a href="#bspline">B-Spline</a></li>
        </ul>
          Essendo il gioco 2D, tutte le curve sopracitate sono curve piane, ovvero, curve il cui poligono di controllo
          giace su un piano; questo implica che hanno torsione pari a 0.<br>
          In questa pagina vengono trattate le rampe curve, sia dal punto di vista matematico, sia dal punto di vista implementativo.<br>
          Le rampe curve create nel gioco discretizzate in 20 segmenti connessi tra loro, lungo i punti della curva(ottenuti tramite le definizioni matematiche).
          Oltre alle rampe curve, ci sono anche le rampe segmentate, che sono ottenute creando segmenti lungo i punti del poligono di controllo; essendo di semplice
          costruzione, non sono trattate in questa pagina.<br>
          Il progetto è stato sviluppato tramite il game engine di Unity.
        </p>

        <h3>Interpolazione</h3>
        <p>
          Nel gioco sono presenti degli ostacoli che si muovono secondo dei percorsi prestabiliti; per spiegare come questi oggetti si muovono, consideriamo un ostacolo mobile, a cui viene associato il percorso 
          \({P_0, P_{1} ... P_N}\).<br>
          Gli ostacoli nel gioco si muovono per interpolazione tra coppie di punti del percorso assegnatogli. <br>
          La prima coppia di punti considerata nell'esempio è \(P_0, P_1\); partendo da \(P_0\), prima o poi, a seconda della curva che utilizzano per l'interpolazione, 
          l'ostacolo raggiunge il punto \(P_1\) del percorso; a quel punto, cambia la coppia di punti utilizzata per l'interpolazione in \(P_1, P_2\), riprendendo l'interpolazione da 0.<br>
          Questo processo continua, finché non raggiunge il punto finale del percorso, ovvero \(P_N\); a quel punto, si riparte con la coppia \(P_0, P_1\). <br>
          Tutti gli ostacoli si muovono seguendo questa logica, usando percorsi diversi e curve diverse. <br>
          A seguito il codice usato per la gestione del movimenti e una piccola dimostrazione del risultato.<br>
          <img class="code_image" src="images/interpolation_code.PNG">
          <img class="centre_big_gif" src="images/obstacle.gif">
          L'ostacolo che si muove nella gif sopra, si muove usando la curva sottostante, sul percorso definito dai punti arancioni.
          <img class="centre_big_image" src="images/curve.png">
        </p>
        <h3 id="bezier">Curve di Beziér</h3>
        <p>
          Una curva di Beziér è una curva parametrica polinomiale definita sull'intervallo chiuso [0, 1]; per costruire
          una curva di Beziér, bisogna definire \(N\) punti che andranno a costruire il suo poligono di controllo.<br>
          \(N\) punti di controllo definiscono il grado della curva, che è  \(N-1\); come già detto nel manuale, per ogni curva, il giocatore può
          usare al massimo 7 punti.<br> 
          Questo significa che il grado massimo delle curve di Beziér utilizzate sarà 6.<br>

          Le curve di Beziér prodotte dal giocatore, sono costruite tramite i polinomi di Bernstein.
        </p>
        <h4>Algoritmo dei polinomi di Bernstein</h4>
        <p>
          Questo algoritmo descrive una curva di Beziér tramite i polinomi di Bernstein, definiti come segue:
          \(P(t) = \sum_{i = 0}^{k} B_i^k(t) * P_i\)<br>
        </p>
        <p>
          \(B_i^k(t) = \frac{k!}{i!*(k-i)!} * (1-t)^{k-i} * t^i\)<br>
        </p>
        <p>
          Spieghiamo ora i vari indici di questa definizione:
        <ul>
          <li>
            \(P(t)\): è il punto che vogliamo valutare della curva in corrispondenza del parametro \(t \in [0, 1]\)
          </li>
          <li>
            \(k\): è il grado della curva
          </li>
          <li>
            \(P_i\): è l'iesimo punto del poligono di controllo della curva
          </li>
          <li>
            \(B_i^k(t)\): è il polinomio di Bernstein valutato nel parametro \(t\) considerando grado \(k\) e indice
            \(i\)
          </li>
        </ul>
        </p>
        <p>
          Scorrendo il parametro \(t\) è quindi possibile definire la curva che di Beziér che parte dal punto iniziale e
          termina nel punto finale.<br>
          L'implementazione dell'algoritmo di Bernstein utilizzata è la seguente:
          <img class="code_image" src="images/bezier_code.PNG">
          Mentre il codice nell'immagine di sotto, mostra come effettivamente la rampa viene costruita nel gioco.<br>
          I punti del poligono di supporto sono definiti dalle posizioni in coordinate locali, rispetto alla trasformazione della curva; questa operazione è svolta dal primo ciclo. <br>
          Nel secondo ciclo, la curva viene discretizzata in 21 punti, che vengono poi utilizzati dal LineRenderer(per disegnarla) e dall'EdgeCollider(per descriverla al motore fisico).<br>
          Il codice qui mostrato è molto simile a quello usato alle altre curve: l'unica cosa che cambia sono le definizioni matematiche usate.<br>
          <img class="code_image" src="images/bezier_ramp.PNG">
          Queste curve, nonostante siano semplici da definire e costruire, soffrono di 2 grossi problemi:
        <ul>
          <li>
            Nessun controllo locale: ogni volta che modifichiamo una curva di Beziér esistente, cambiamo la definizione della curva stessa.
          </li>
          <li>
            Non adatte per costruire curve lunghe: come sappiamo dalla teoria, il grado di una curva di Beziér dipende dal numero di punti; 
            questo implica, che più punti definiamo per una curva, più la sua valutazione e modifica diventa più onerosa.<br>
            Per questo motivo, si preferiscono le curve spline in questi contesti.
          </li>
        </ul>
        </p>
        <h3 id="hermite">Spline cubiche di Hermite</h3>
        <p>
          Una spline cubica di Hermite è una curva composta da curve di Beziér di grado 3, incollate
          lungo i punti del poligono di controllo con incollamento C1; tutte le parti sono parametrizzate sul medesimo intervallo [0, 1].<br>
          Per definire queste spline, oltre a fornire gli \(N\) punti del poligono di controllo, bisogna anche definire gli \(N\) vettori tangenti 
          associati a questi.<br>
          Questi vettori tangenti, impongono le direzioni tangenti, che le varie curve di Beziér devono rispettare lungo la spline; questo implica che gli incollamenti della curva sono di tipo \(C1\).<br>
          Le curve di Hermite che si possono costruire nel gioco, possono avere al massimo 7 punti.<br>
          La definizione matematica di queste spline è basata sui polinomi di Hermite \(H\): dati i punti \(Q_0\) e \(Q_1\) ai quali sono associati i vettori tangenti \(m_0\) e \(m_1\), 
          è possibile definire i punti di controllo \(P_0\),\(P_1\),\(P_2\) e \(P_3\) di un frammento della curva in questo modo:
        </p>
        <p>
          \(P_0 = Q_0\)<br>
        </p>
        <p>
          \(P_1 = Q_0+m_0*1/3\)<br>
        </p>
        <p>
          \(P_2 = Q_1+m_1*1/3\)<br>
        </p>
        <p>
          \(P_3 = Q_1\)<br>
        </p>
        <p>
          Dati questi punti, è possibile definire i polinomi di Hermite:
        </p>
        <p>
          \(H_0^3(t) = B_0^3(t)+B_1^3(t)\)<br>
        </p>
        <p>
          \(H_1^3(t) = \frac{1}{3}*B_1^3(t)\)<br>
        </p>
        <p>
          \(H_2^3(t) = \frac{1}{3}*B_2^3(t)\)<br>
        </p>
        <p>
          \(H_3^3(t) = B_2^3(t)+B_3^3(t)\)<br>
        </p>
        <p>
          Tramite questi, possiamo definire la curva di Beziér di grado 3 che ha le caratteristiche descritte prima.
        </p>
        <p>
          \(P(t) = H_0^3(t)*Q_0+H_1^3(t)*Q_1+H_2^3(t)*Q_2+H_3^3(t)*Q_3\)<br>
        </p>
        <p>
          La spine quindi è costruita usando questa definizione, per ogni coppia di punti e tangenti che la compongono.<br>
          Passiamo ora alla definizione di queste curva da codice:
          <img class="code_image" src="images/hermite_code.PNG">
          Il modulo dei vettori associati a ciascun punto è una costante(6). 
          <img class="code_image" src="images/hermite_ramp.PNG">
          Questo tipo di curve, sono preferite rispetto alle classiche curve di Beziér perché non soffrono dei problemi precedentemente citati.

        </p>   
        <h3 id="bspline">B-Spline</h3>
        <p>
          Le curve b-spline, come le spline cubiche di Hermite sono curve composte da curve di Beziér opportunamente incollate; a differenza 
          delle cubiche di Hermite, non passano nei punti identificati dal poligono di controllo, ma si limitano ad approssimare i punti del poligono di controllo.<br>
          Il dominio di queste curve diversamente da quelle che abbiamo visto fin'ora, non necessariamente è [0, 1]. <br>
          Esistono 3 tipi di b-spline:
          <ul>
            <li>
              b-spline uniformi: sono b-spline parametrizzate su intervalli della stessa ampiezza
            </li>
            <li>
              b-spline non uniformi: b-spline parametrizzate su intervalli di ampiezza diversa
            </li>
            <li>
              b-spline non uniformi razionali: chiamate anche "nurbs", definite come rapporto di curve polinomiali. 
            </li>
          </ul>
          In Spline Ramp, le b-spline generate sono tutte b-spline cubiche non-uniformi, composte al massimo da 7 punti. <br>
          Il numero di curve incollate dipende dal numero di punti del poligono di controllo; supponiamo di avere la seguente sequenza di punti \(P_1, P_2 ... P_N\). <br>
          Con \(N\) punti del poligono di controllo, si incollano \(N-3\) curve di Beziér cubiche (se \(N \gt 4\)).<br>
          Nel caso in cui, il giocatore fornisca un numero di punti \(N\le 4\) per la costruzione della b-spline, l'applicazione genererà una curva di Beziér di grado \(N-1\). <br>
          La parametrizzazione degli elementi di una b-spline sfrutta un vettore di valori crescenti, chiamato vettore nodi; ciascuna coppia di valori nodali \(t_i\) e \(t_{i+1}\) sono i parametri di interpolazione, utilizzati da una certa curva che compone la b-spline.
          I valori contenuti in questo vettore, possono essere ripetuti, alterando la continuità della curva che si andrà a costruire.<br>
          In particolare, ripetendo un valore nodale tante volte quante il grado \(K\) delle curve di Beziér usate, forzerà la curva a passare per tale punto. <br>
          Nel progetto infatti, i valori nodali iniziali e finali sono ripetuti 3 volte, per forzare le curve a passare per il punto iniziale e finale. <br>
          Il tipo di incollamento di queste curve dipende da due elementi: la molteplicità del valore nodale in un certo nodo e il grado delle curve di Beziér incollate; dato quindi un nodo 
          con molteplicità \(P\) e curve di grado \(K\), il tipo di incollamento presso quel nodo è di tipo \(C^{K-P}\); questo significa che nei punti iniziali e finali, le curve sono continue, ma non derivabili, 
          mentre gli incollamenti interni sono tutti \(C2\) (supponendo che non ci siano nodi interni ripetuti). <br>
          Deve inoltre valere una condizione tra il numero dei nodi \(M\), il grado della spline \(K\) e il grado delle curve di Beziér usate: \(M=N+K+1\).<br>
          Un'ultima proprietà particolare di queste curve è relativa al grado delle curve di Beziér utilizzate: più è basso il grado delle curve di Beziér utilizzate, più la b-spline ottenuta approssima meglio il 
          poligono di controllo fornito.<br>
          Fatte queste premesse, passiamo quindi alla descrizione di queste curve tramite l'algoritmo di DeBoor-Cox.
        </p>

        <h4>Algoritmo di DeBoor-Cox</h4>
        <p>
          Questo algoritmo definisce un punto della b-spline come somma dei punti del poligono di controllo, moltiplicati per funzioni base:
        </p>
        <p>
          \(P(t) = \sum_{i = 0}^{n-1} B_{i, k}(t) * P_i\)<br>
        </p>
        <p>
          Spieghiamo i termini e gli indici e termini che compaiono nella sommatoria appena scritta:
        </p>
        <p>
        <ul>
          <li>
            \(P_i\): sono i punti del poligono di controllo
          </li>
          <li>
            \(B_{i, k}(t)\): è una funzione base di \(i\) e \(k\) valutata su \(t\).
          </li>
          <li>
            \(n\): è il numero di punti del poligono di controllo
          </li>
          <li>
            \(k\): è il grado della b-spline(3)
          </li>
        </ul>
        </p>
        <p>
          I polinomi \(B_{i, k}(t)\) sono polinomi ricorsivi di DeBoor:<br><br>
          \(B_{i, 1}=\begin{cases}
          0 \text{ se } t_i \le t \lt t_{i+1}\\
          1 \text{ altrimenti}
          \end{cases}\)
          <br><br>
          \(B_{i, k}=\frac{t-t_i}{t_{i+k-1}-t_i}*B_{i, k-1}(t) + \frac{t_{i+k}-t}{t_{i+k}-t_{i+1}}*B_{i+1, k-1}(t)\)
          <br><br>
          Questa definizione produce molte volte \(\frac{0}{0}\) che vengono gestiti come fattori 0.<br>
          A seguito il codice che implementa il tutto.
          <img class="code_image" src="images/bspline_code.PNG">
          Questo è il codice che sfrutta la definizione matematica, per costruire la rampa nel gioco.<br>
          Come si può vedere, nel caso in cui il numero di punti sia minore o uguale a 4, la curva prodotta è una normale curva di Beziér; in tutti gli altri casi, 
          la b-spline è costruita.<br>
          I vettori dei nodi sono vettori costanti sifatti: <br>
          <ul>
            <li>
              KNOTS_5 = [0, 0, 0, 0, 1, 2, 2, 2, 2]
            </li>
            <li>
              KNOTS_6 = [0, 0, 0, 0, 1, 2, 3, 3, 3, 3]
            </li>
            <li>
              KNOTS_7 = [0, 0, 0, 0, 1, 2, 3, 4, 4, 4, 4]
            </li>
          </ul>
          <img class="code_image" src="images/bspline_ramp.PNG">
        </p>
      </div>
    </div>
  </div>
  </div>
  </div>
  </div>
</body>

</html>